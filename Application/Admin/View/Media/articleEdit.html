<html>
<head>
    <title>发布资讯</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <link href="__PUBLIC__/css/bootstrap.css" rel="stylesheet">
    <script type="text/javascript" src="__PUBLIC__/js/jquery/jquery.js"></script>
    <script src="__PUBLIC__/js/bootstrap/bootstrap.js"></script>
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/editor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/editor/ueditor.all.min.js"> </script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
    <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/editor/lang/zh-cn/zh-cn.js"></script>
</head>
<body>
	<include file="./Public/tpl/navbar_admin.html" />
	<div class="container">
		<div class="page-header">
	      <!-- 页面标题 -->
	    	<h3>资讯编辑</h3>
	    </div>
	    <div class="row">
	    	<div class="col-md-10 col-md-offset-1 col-xs-12">
	    		<input type="text" id="subject" class="form-control" placeholder="标题">
	    	</div>
	    </div>
	    <div class="row">
	    	<div class="col-md-10 col-md-offset-1 col-xs-12">
			    <script id="myEditor" type="text/plain" style="height:500px;"></script>
			</div>
		</div>
        <div class="row">
            <div class="col-md-5 col-md-offset-1 col-xs-12">
                <div class="form-group">
                  <label for="artiType"><span class="required">*</span>发布板块</label>
                  <select class="form-control" id="artiType">
                  </select>
                </div>
            </div>
            <div class="col-md-5 col-xs-12">
                <div class="form-group">
                  <label for="artiField"><span class="required">*</span>文章领域</label>
                  <select class="form-control" id="artiField">
                  </select>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-5 col-md-offset-1 col-xs-12">
                <div class="form-group">
                  <label for="artiObj"><span class="required">*</span>关联对象</label>
                  <input type="text" id="artiObj" class="form-control">
                </div>
            </div>
            <div class="col-md-5 col-xs-12">
                <div class="form-group">
                  <label for="artiAbout"><span class="required">*</span>对象类型</label>
                  <select class="form-control" id="artiAbout">
                  </select>
                </div>
            </div>
        </div>
		<div class="row">
			<div class="col-md-3 col-md-offset-1 col-xs-6">
				<input type="submit" class="btn btn-primary" value="发布" id="change" onclick="submitArticle()"/>
		        <input type="button" class="btn btn-default" value="预览" onclick="preview()"/>
		    </div>
		    <div class="text-right">
		    	<div class="col-md-7 col-xs-6">
		        <a type="button" class="btn btn-default" href="__URL__/index">返回</a>
		    	</div>
		    </div>
	    </div>
	</div>
</body>
<script src="__PUBLIC__/js/util/editor.js"></script>
<script src="__PUBLIC__/js/util/send_msg.js"></script>
<script type="text/javascript">
    
    var um;
    function preview(){
        var result = unescape(getContent());
        document.write(result);
    }

    function addOption(value,index,id){
        var option = $('<option></option').text(value);
        option.attr('value',index);
        $(id).append(option);
    }

    function addField(value,id){
        var fields = value;
        for(var i in fields){
          addOption(fields[i],i,id);
        }
    }

    function alertContent(){
        alert(getContent(um));
    }

    
    addField({$type},"#artiType");
    addField({$field},"#artiField");
    addField({$object},"#artiAbout");
    
    if({$fill_type}==1)
    {
        preFill();
    }else
    {
        um = editorInitialize("myEditor");
    }
    function preFill()
    {
    // if this html is for old article, pre fill the blank
        $("#subject").val("{$article.article_title}");
        $('#artiType').children('option').each(function(){
            if($(this).val()=='{$article.article_type}'){
            $(this).attr('selected','selected');
            }
        });
        $('#artiField').children('option').each(function(){
            if($(this).val()=='{$article.article_field}'){
            $(this).attr('selected','selected');
            }
        });
        $('#artiObj').children('option').each(function(){
            if($(this).val()=='{$article.article_object}'){
            $(this).attr('selected','selected');
            }
        });
        $('#artiAbout').children('option').each(function(){
            if($(this).val()=='{$article.article_about}'){
            $(this).attr('selected','selected');
            }
        });
        um = editorInitialize("myEditor",unescape('{$article.article_content}'));
    
    }

    function submitArticle(){
        var title = "key1="+$("#subject").val()+"&";
        var type = "key2="+$("#artiType").val()+"&";
        var field = "key3="+$("#artiField").val()+"&";
        var object = "key4="+$("#artiObj").val()+"&";
        var about = "key5="+$("#artiAbout").val()+"&"; 
        var content = "key6="+getContent(um)+"&";
        var data = title+type+field+object+about+content;
        var xmlhttp = createRequest();

        xmlhttp.onreadystatechange=function()
        {
            if (xmlhttp.readyState==4 && xmlhttp.status==200)
            {
                //alert(xmlhttp.responseText);
                alert(xmlhttp.responseText);
            }
        }
        if ({$fill_type}==1) 
        {
            data=data+"key7={$article.article_id}";
            xmlhttp.open("POST","articleUpdate",true);
            xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
            xmlhttp.send(data);
        }else
        {
            xmlhttp.open("POST","articleSave",true);
            xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
            xmlhttp.send(data);
        }
        
       
        /*if({$fill_type})
        {
            data=data+"key7={$article.article_id}";
            request(xmlHttp,data,"articleUpdate");
        }
        else
            request(xmlHttp,data,"articleSave");*/
        

    }

    
    
</script>

</html>
